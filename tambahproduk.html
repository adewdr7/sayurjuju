<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tambah Produk - Pasar Segar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen p-4 pb-12">

    <div class="max-w-xl mx-auto">
        <nav class="p-4 flex items-center gap-3 sticky top-0 
    bg-slate-950/90 backdrop-blur-md z-40 
    border-b border-slate-900 mb-6">
    
    <a href="index.html" class="p-2 bg-slate-900 rounded-xl border border-slate-800 text-slate-400">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
    </a>

    <h2 class="text-lg font-bold">Tambah Produk Baru</h2>
</nav>

        <div id="auth-guard" class="hidden text-center py-20 bg-slate-900 rounded-3xl border border-slate-800">
            <i data-lucide="lock" class="w-12 h-12 mx-auto text-slate-700 mb-4"></i>
            <h3 class="font-bold text-slate-300">Akses Dibatasi</h3>
            <p class="text-slate-500 text-sm mb-6 px-6">Hanya admin yang dapat menambahkan produk ke katalog.</p>
            <a href="login.html" class="px-6 py-3 bg-emerald-500 rounded-xl font-bold inline-block">Login Admin</a>
        </div>

        <form id="product-form" class="hidden space-y-5 bg-slate-900 p-6 rounded-3xl border border-slate-800 shadow-2xl">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-xs text-slate-400 mb-2 font-semibold">NAMA PRODUK</label>
                    <input type="text" id="p-name" required placeholder="Contoh: Wortel Brastagi" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-sm focus:border-emerald-500 outline-none">
                </div>
                
                <div>
                    <label class="block text-xs text-slate-400 mb-2 font-semibold">KATEGORI</label>
                    <select id="p-category" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-sm focus:border-emerald-500 outline-none appearance-none">
                        <option value="Sayur Mentah">Sayur Mentah</option>
                        <option value="Buah">Buah</option>
                        <option value="Bumbu Dapur">Bumbu Dapur</option>
                        <option value="Ikan">Ikan</option>
                        <option value="Daging">Daging</option>
                        <option value="Makanan">Makanan</option>
                        <option value="Pangan">Pangan</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs text-slate-400 mb-2 font-semibold">SATUAN</label>
                    <select id="p-unit" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-sm focus:border-emerald-500 outline-none">
                        <option value="kg">kg</option>
                        <option value="pcs">pcs</option>
                        <option value="ons">ons</option>
                        <option value="g">g</option>
                    </select>
                </div>

                <div>
                    <label class="block text-xs text-slate-400 mb-2 font-semibold">HARGA (RP)</label>
                    <input type="number" id="p-price" required placeholder="0" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-sm focus:border-emerald-500 outline-none">
                </div>

                <div>
                    <label class="block text-xs text-slate-400 mb-2 font-semibold">STOK</label>
                    <input type="number" id="p-stock" required placeholder="0" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-sm focus:border-emerald-500 outline-none">
                </div>
            </div>

            <div>
                <label class="block text-xs text-slate-400 mb-2 font-semibold">WAKTU PEMBELIAN</label>
                <input type="datetime-local" id="p-purchase-time" class="w-full bg-slate-950 border border-slate-800 rounded-2xl p-4 text-sm focus:border-emerald-500 outline-none">
            </div>

            <div>
                <label class="block text-xs text-slate-400 mb-2 font-semibold">STATUS KESEGARAN</label>
                <div class="flex gap-4">
                    <label class="flex-1 flex items-center justify-center gap-2 p-4 bg-slate-950 border border-slate-800 rounded-2xl cursor-pointer has-[:checked]:border-emerald-500 has-[:checked]:bg-emerald-500/5 transition-all">
                        <input type="radio" name="p-status" value="Segar" checked class="hidden"> 
                        <span class="text-sm font-semibold">Segar</span>
                    </label>
                    <label class="flex-1 flex items-center justify-center gap-2 p-4 bg-slate-950 border border-slate-800 rounded-2xl cursor-pointer has-[:checked]:border-amber-500 has-[:checked]:bg-amber-500/5 transition-all">
                        <input type="radio" name="p-status" value="Lama" class="hidden"> 
                        <span class="text-sm font-semibold">Lama</span>
                    </label>
                </div>
            </div>

            <div>
                <label class="block text-xs text-slate-400 mb-2 font-semibold">URL GAMBAR (OPSIONAL)</label>
                <input type="file" id="p-image" accept="image/*">
            </div>

            <button type="submit" id="btn-submit" class="w-full bg-emerald-500 hover:bg-emerald-600 py-5 rounded-2xl font-bold shadow-xl shadow-emerald-900/20 transition-all flex justify-center items-center gap-2">
                Simpan ke Katalog
            </button>
        </form>
    </div>

  <script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

/* ===============================
   CONFIG
================================ */
const firebaseConfig = {
    apiKey: "AIzaSyBWkPqyh54IRccNz2YjuB1bL5r49YadAP4",
    authDomain: "sayurjuju-bfe82.firebaseapp.com",
    projectId: "sayurjuju-bfe82",
    storageBucket: "sayurjuju-bfe82.firebasestorage.app",
    messagingSenderId: "754413439458",
    appId: "1:754413439458:web:341c9fe99fd9b1550551bb"
};

const CLOUD_NAME = "dvjfrrusn";
const UPLOAD_PRESET = "sayurjuju";
const ADMIN_UID = "XVmdoXxSptTlA8xHVmAIzeLgkru2";

/* ===============================
   INIT FIREBASE
================================ */
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const productsRef = collection(db, "products");

/* ===============================
   AUTH GUARD
================================ */
onAuthStateChanged(auth, (user) => {
    const form = document.getElementById("product-form");
    const guard = document.getElementById("auth-guard");

    if (user && user.uid === ADMIN_UID) {
        form.classList.remove("hidden");
        guard.classList.add("hidden");
    } else {
        form.classList.add("hidden");
        guard.classList.remove("hidden");
    }
});

/* ===============================
   CLOUDINARY UPLOAD
================================ */
async function uploadToCloudinary(file) {
    const formData = new FormData();
    formData.append("file", file);
    formData.append("upload_preset", UPLOAD_PRESET);

    const res = await fetch(
        `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/image/upload`,
        {
            method: "POST",
            body: formData
        }
    );

    const data = await res.json();

    if (!data.secure_url) {
        throw new Error("Upload gambar gagal");
    }

    return data.secure_url;
}

/* ===============================
   SUBMIT FORM
================================ */
document.getElementById("product-form").addEventListener("submit", async (e) => {
    e.preventDefault();

    const btn = document.getElementById("btn-submit");
    btn.disabled = true;
    btn.innerText = "Upload gambar...";

    try {
        let imageUrl = "https://images.unsplash.com/photo-1542831371-29b0f74f9713?w=300";
        const fileInput = document.getElementById("p-image");

        if (fileInput.files.length > 0) {
            imageUrl = await uploadToCloudinary(fileInput.files[0]);
        }

        btn.innerText = "Menyimpan produk...";

        const newProduct = {
            name: document.getElementById("p-name").value,
            category: document.getElementById("p-category").value,
            price: parseInt(document.getElementById("p-price").value),
            unit: document.getElementById("p-unit").value,
            stock: parseInt(document.getElementById("p-stock").value),
            status: document.querySelector('input[name="p-status"]:checked').value,
            image: imageUrl,
            purchaseTime: new Date().toISOString()
        };

        await addDoc(productsRef, newProduct);

        alert("Produk berhasil ditambahkan!");
        window.location.href = "index.html";

    } catch (err) {
        alert("Error: " + err.message);
        btn.disabled = false;
        btn.innerText = "Simpan ke Katalog";
    }
});
lucide.createIcons();
</script>
</body>
</html>


